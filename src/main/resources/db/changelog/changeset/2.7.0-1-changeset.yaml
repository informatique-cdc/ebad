databaseChangeLog:
  - changeSet:
      id: creation_identity_constraint
      author: dtrouillet
      changes:
        - insert:
            tableName: t_identity
            columns:
              - column:
                  name: created_by
                  value: SYSTEM
              - column:
                  name: created_date
                  value: NOW()
              - column:
                  name: name
                  value: default
              - column:
                  name: login
                  value: default_login
              - column:
                  name: password
                  value: changeme
        - dropColumn:
            tableName: t_environnement
            columns:
              - column:
                  name: login
        - addColumn:
            tableName: t_environnement
            columns:
              - column:
                  name: identity_id
                  type: BIGINT
        - addForeignKeyConstraint:
            baseColumnNames: identity_id
            baseTableName: t_environnement
            constraintName: t_environnement_identity_id
            deferrable: false
            initiallyDeferred: false
            onDelete: NO ACTION
            onUpdate: NO ACTION
            referencedColumnNames: id
            referencedTableName: t_identity
            validate: true
        - update:
            tableName: t_environnement
            columns:
              - column:
                  name: identity_id
                  value: (SELECT id  from t_identity where name = 'default')
        - addNotNullConstraint:
            tableName: t_environnement
            columnName: identity_id

